define("editor_tools/ace_text_adapter",["require"],function(e){var t;return t=function(){function e(e){this.ace=e,this.session=this.ace.getSession()}return e.prototype.getText=function(){return this.ace.getValue()},e.prototype.insert=function(e,t){return this.session.insert(e,t)},e.prototype.getSelectedRange=function(){return this.session.getSelection().getRange()},e.prototype.getCursorPosition=function(){return this.ace.getCursorPosition()},e.prototype.setCursorPosition=function(e){return this.ace.moveCursorToPosition(e),this.ace.clearSelection()},e.prototype.focus=function(){return this.ace.focus()},e.prototype.isPositionBefore=function(e,t){return e.row!==t.row?e.row<t.row:e.column<t.column},e.prototype.addPositionOffset=function(e,t){return{row:e.row,column:e.column+t}},e.prototype.insertAtCursor=function(e){return this.ace.insert(e)},e.prototype.getLineIterator=function(e){var t,n;return n=this.session,t={l:e.row,c:e.column,getOffsetInLine:function(){return this.c},getPos:function(){return{row:this.l,column:0}},getLine:function(){return n.getLine(this.l)},hasNext:function(){return this.l<n.getLength()},hasPrevious:function(){return this.l>0},getNext:function(){return this.l++,this.c=0,this.getLine()},getPrevious:function(){return this.l--,this.c=0,this.getLine()}},t},e}(),t});var __slice=[].slice;define("editor_tools/text_utils",["require"],function(e){var t;return t=function(){function e(e){this.editor=e,this.editor.getText()}return e.prototype.embbedSelectedText=function(e,t){return this.embbedText(this.editor.getSelectedRange(),e,t)},e.prototype.focus=function(){return this.editor.focus()},e.prototype.insert=function(e,t){typeof e=="string"&&(t=e,e=this.editor.getCursorPosition()),this.editor.insert(e,t)},e.prototype.getPos=function(){return this.editor.getCursorPosition()},e.prototype.setPos=function(e){return this.editor.setCursorPosition(e)},e.prototype.indentToNextLine=function(e){var t,n,r;e==null&&(e=this.editor.getCursorPosition()),t=this.editor.getLineIterator(e),n=t.getLine(),r=n.match(/^[\s]*/),r!=null?r=r[0]:r="";if(r.length===n.length)return;return this.editor.insert(e,"\n"+r)},e.prototype.getEol=function(e){var t,n;return e==null&&(e=this.editor.getCursorPosition()),t=this.editor.getLineIterator(e),n=t.getLine().length-t.getOffsetInLine(),e=this.editor.addPositionOffset(e,n),e},e.prototype.searchReverse=function(e,t,n){var r,i,s,o,u,a;r=this.editor,i=r.getLineIterator(e),u=!1,o=function(){var t,s,o;s=1<=arguments.length?__slice.call(arguments,0):[];if(u)return;t=s[s.length-2],o=r.addPositionOffset(i.getPos(),t);if(r.isPositionBefore(e,o))return;if(n(o,s)===!1)return u=!0},i.getLine().replace(t,o),a=[];while(i.hasPrevious()){if(u)break;s=i.getPrevious(),a.push(s.replace(t,o))}return a},e.prototype.embbedText=function(e,t,n){if(e.isEmpty())return;return console.log(e),this.editor.insert(e.end,n),this.editor.insert(e.start,t)},e}(),t});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define("editor_tools/tex_utils",["require","editor_tools/text_utils"],function(e){var t,n;return n=e("editor_tools/text_utils"),t=function(e){function t(e){this.editor=e,t.__super__.constructor.call(this,e)}return __extends(t,e),t.prototype.getEnvironmentAtPos=function(e){var t,n;return e==null&&(e=this.editor.getCursorPosition()),t={},n=null,this.searchReverse(e,/\\(begin|end)\{([a-zA-Z0-9- ]+)\}/g,function(e,r){t[r[2]]==null&&(t[r[2]]=0),r[1]==="end"?t[r[2]]--:t[r[2]]++;if(t[r[2]]>0)return n=r[2],!1}),n},t}(n),t}),define("editor_tools/scriptable_toolbar",["require"],function(e){var t;return t=function(){function e(e,t){this.id=e,this.interpretter=t}return e.prototype.addButton=function(e,t,n){var r;return r=this,$(this.id).append("<button id='"+e+"'>"+t+"</button>"),$("#"+e).click(function(){return r.interpretter.exec(n)})},e.prototype.init=function(e){var t,n,r;r=[];for(t in e)n=e[t],r.push(this.addButton(t,n.name,n.code));return r},e}()}),define("editor_tools/interpretter",["require"],function(require){var Interpreter;return Interpreter=function(){function Interpreter(e){this.env=e}return Interpreter.prototype.exec=function(script){var s;try{eval("with (this.env) { s = eval(script); }")}catch(e){s=e}if(s!=null&&s.toString!=null)return s.toString()},Interpreter.prototype.autocomplete=function(e,t){var n,r;r=[];for(n in this.env)console.log("prop",n),n.indexOf(e)===0&&r.push(n);return t(r)},Interpreter}()}),define("editor_tools/main",["require","editor_tools/ace_text_adapter","editor_tools/tex_utils","editor_tools/scriptable_toolbar","editor_tools/interpretter"],function(e){var t,n,r,i;return t=e("editor_tools/ace_text_adapter"),r=e("editor_tools/tex_utils"),i=e("editor_tools/scriptable_toolbar"),n=e("editor_tools/interpretter"),{enrich_editor:function(e,s){var o,u,a,f,l,c,h,p,d;return d=$(s).wrap("<div>").parent(),$(s).addClass("ui-layout-center"),u=$("<div>").addClass("ui-layout-north"),c=$("<div>").addClass("ui-layout-south"),d.prepend(u),d.append(c),f=null,jQuery(document).ready(function(){return $(d).width($(s).width()),$(d).height($(s).height()),f=d.layout({enableCursorHotkey:!1,north:{closable:!1,size:20,resizable:!1},south:{resizable:!0,size:80,initClosed:!0}})}),o=new t(e),h=new r(o),a=new n(h),p=new i(u,a),jQuery.get("macros/tex.json",function(e){return p.init(JSON.parse(e))}),l=function(t){if(t.keyCode===192&&t.ctrlKey)return conso,f.state.south.isClosed?(f.open("south"),$(c).trigger("click"),$(c).focus(),e.blur()):(f.close("south"),e.focus()),!1},$(c).terminal(function(e,t){return t.echo(a.exec(e))},{greetings:"",tabcompletion:!0,keyDown:l,completion:function(e,t,n){return a.autocomplete(t,n)}}),$(d).keydown(l)}}});